<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kho qu·∫πt ‚Äì Nh√† B·∫øp Nh·ªè</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Lora:wght@400;500;600&display=swap" rel="stylesheet"/>

  <style>
    /* ================= IDENTICAL CSS FROM PANCAKE PAGE ================= */
    :root {
      --p1: #ffe1e8;
      --p2: #fdf0c4;
      --p3: #e3f4f4;
      --p4: #e8e1ff;
      --text: #4a3b36;
      --muted: #8b7d75;
      --shadow: 0 20px 40px rgba(0,0,0,0.06);
      --radius: 22px;
      --accent: #f3bccc;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: "Lora", serif;
      background: linear-gradient(135deg, #fff9f3, #fbe9ff);
      color: var(--text);
      line-height: 1.7;
      overflow-x: hidden;
    }

    .container {
      max-width: 1100px;
      margin: auto;
      padding: 24px;
      position: relative;
    }

    /* Doodles */
    .doodle {
      position: absolute;
      opacity: 0.16;
      mix-blend-mode: multiply;
      pointer-events: none;
      z-index: -1;
    }
    .d1 { width:150px;height:150px;border-radius:50%;border:2px dashed #f3bccc;top:10px;left:-40px;animation:float 9s infinite; }
    .d2 { width:130px;height:130px;border-radius:40px;border:2px solid #cde7e4;right:4%;top:40%;transform:rotate(-10deg);animation:wobble 7s infinite; }
    .d3 { width:120px;height:120px;border-radius:50%;border:2px dotted #f2d37a;bottom:0;right:-50px;animation:float 10s infinite reverse; }
    .doodle::before { content:"üç≤";position:absolute;font-size:26px;top:50%;left:50%;transform:translate(-50%,-50%);opacity:.7; }

    @keyframes float { 0%,100%{transform:translateY(0);}50%{transform:translateY(-12px);} }
    @keyframes wobble { 0%,100%{transform:rotate(-10deg);}50%{transform:rotate(5deg);} }

    /* NAV */
    nav {
      background:white;
      padding:16px 24px;
      border-radius:18px;
      box-shadow:var(--shadow);
      border:1px solid #ecdcd3;
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:24px;
      position:sticky;
      top:10px;
      z-index:10;
      backdrop-filter:blur(10px);
    }

    .logo { font-family:"Great Vibes",cursive;font-size:32px; }

    .menu a {
      margin-left:20px;
      text-decoration:none;
      color:var(--text);
      font-size:15px;
      font-weight:500;
      position:relative;
    }
    .menu a::after {
      content:"";
      position:absolute;
      left:0; bottom:-3px;
      width:0; height:2px;
      background:linear-gradient(90deg,#f3bccc,#f2d37a);
      transition:width .25s;
    }
    .menu a:hover::after { width:100%; }

    /* HERO */
    .hero {
      display:grid;
      grid-template-columns:minmax(0,1.3fr) minmax(0,1fr);
      gap:26px;
      margin-bottom:30px;
      align-items:center;
    }

    .recipe-title { font-family:"Great Vibes";font-size:46px;margin-bottom:2px; }

    .fav-btn {
      width:32px;height:32px;border-radius:50%;border:1px solid #f3c7d3;
      display:flex;align-items:center;justify-content:center;
      cursor:pointer;background:#fff7fb;transition:.2s;box-shadow:0 6px 14px rgba(0,0,0,0.05);
    }
    .fav-btn.active { background:#ffe1ec;box-shadow:0 10px 20px rgba(240,138,166,0.4); }
    .fav-btn.active span { transform:scale(1.2); }

    .chip { background:var(--p4);padding:4px 10px;font-size:11px;border-radius:999px;border:1px solid #dcd2ff;color:#6a5fa3; }

    .hero-image { width:100%;height:260px;object-fit:cover;border-radius:26px;box-shadow:var(--shadow); }

    .main-layout { display:grid;grid-template-columns:minmax(0,1.3fr) minmax(0,1fr);gap:26px; }

    .card {
      background:white;border-radius:var(--radius);
      padding:18px 18px 20px;box-shadow:var(--shadow);
      border:1px solid #ecdcd3;margin-bottom:20px;
    }

    .pill-label {
      display:inline-block;padding:3px 9px;border-radius:999px;font-size:11px;
      background:var(--p3);border:1px solid #cfe7e4;color:#557d79;margin-bottom:6px;
      text-transform:uppercase;letter-spacing:.12em;
    }

    .shopping-drop {
      min-height:60px;padding:8px;border-radius:14px;background:#fffdf2;border:1px dashed #e7cf8b;
      font-size:13px;
    }

    textarea.notes-area { width:100%;min-height:80px;border-radius:14px;padding:10px;border:1px solid #ecdcd3; }

    @media(max-width:820px){
      .hero,.main-layout { grid-template-columns:1fr; }
    }
  </style>
</head>

<body>

<div class="container">

  <!-- DOODLES -->
  <div class="doodle d1"></div>
  <div class="doodle d2"></div>
  <div class="doodle d3"></div>

  <!-- MOOD POPUP -->
  <div class="mood-overlay" id="moodOverlay">
    <div class="mood-box">
      <div class="mood-title">H√¥m nay b·∫°n th·∫•y sao?</div>
      <div class="mood-sub">M√¨nh g·ª£i √Ω c√°ch d√πng m√≥n n√†y t√πy t√¢m tr·∫°ng nh√©.</div>
      <div class="mood-buttons">
        <button class="mood-btn" data-mood="met">M·ªát m·ªèi</button>
        <button class="mood-btn" data-mood="healthy">Mu·ªën nh·∫π b·ª•ng</button>
        <button class="mood-btn" data-mood="voi">ƒêang v·ªôi</button>
        <button class="mood-btn" data-mood="anui">Mu·ªën ·∫•m b·ª•ng</button>
      </div>
      <div class="mood-note" id="moodNote"></div>
    </div>
  </div>

  <!-- NAV -->
  <nav>
    <div class="logo">Nh√† B·∫øp Nh·ªè</div>
    <div class="menu">
      <a href="index.html">Trang ch·ªß</a>
      <a href="mon-man.html"><b>M√≥n m·∫∑n</b></a>
      <a href="mon-ngot.html">M√≥n ng·ªçt</a>
      <a href="do-uong.html">ƒê·ªì u·ªëng</a>
    </div>
  </nav>

  <!-- TOP ACTIONS -->
  <div class="top-actions">
    <button class="btn-soft" id="moodBtn"><span class="icon">üí≠</span>H·ªèi mood h√¥m nay</button>
    <button class="btn-soft" id="randomBtn"><span class="icon">üé°</span>H√¥m nay ƒÉn g√¨?</button>
    <div class="random-result" id="randomResult"></div>
  </div>

  <!-- HERO -->
  <section class="hero">
    <div class="hero-text">
      <div class="recipe-title-row" style="display:flex;align-items:center;gap:12px;">
        <div class="recipe-title">Kho qu·∫πt</div>
        <div>
          <div class="fav-btn" id="favBtn"><span id="favIcon">‚ô°</span></div>
          <div class="fav-label" id="favLabel" style="font-size:11px;color:var(--muted);">Th√™m v√†o y√™u th√≠ch</div>
        </div>
      </div>

      <div class="subtitle" style="font-size:14px;color:var(--muted);margin-bottom:10px;">
        M·∫∑n ng·ªçt h√†i h√≤a, th∆°m m√πi t√¥m th·ªãt ‚Äì m√≥n ch·∫•m ‚Äúqu·ªëc d√¢n‚Äù cho m·ªçi b·ªØa c∆°m nh√†.
      </div>

      <div class="chips">
        <div class="chip">40 ph√∫t</div>
        <div class="chip">D·ªÖ</div>
        <div class="chip">M√≥n m·∫∑n</div>
        <div class="chip">ƒê∆∞a c∆°m</div>
      </div>

      <div class="rating-row" style="display:flex;align-items:center;gap:8px;font-size:13px;">
        <span>ƒê√°nh gi√° c·ªßa b·∫°n:</span>
        <div class="stars" id="starContainer">
          <span data-star="1">‚òÖ</span>
          <span data-star="2">‚òÖ</span>
          <span data-star="3">‚òÖ</span>
          <span data-star="4">‚òÖ</span>
          <span data-star="5">‚òÖ</span>
        </div>
        <span id="ratingText">(ch∆∞a c√≥)</span>
      </div>

      <p class="hero-intro" style="font-size:14px;">
        Kho qu·∫πt l√† m√≥n ch·∫•m truy·ªÅn th·ªëng c·ªßa ng∆∞·ªùi mi·ªÅn T√¢y, n·ªïi ti·∫øng b·ªüi v·ªã m·∫∑n ng·ªçt ƒë·∫≠m ƒë√†, th∆°m m√πi t√≥p m·ª°,
        t√¥m kh√¥ v√† ti√™u ·ªõt. ƒÇn c√πng rau lu·ªôc, c∆°m n√≥ng ho·∫∑c c∆°m ch√°y ƒë·ªÅu ‚Äúcu·ªën‚Äù v√¥ c√πng.
        C√¥ng th·ª©c d∆∞·ªõi ƒë√¢y gi·ªØ ƒë√∫ng tinh th·∫ßn d√¢n d√£ nh∆∞ng d·ªÖ l√†m ‚Äì h·ª£p v·ªõi c·∫£ ng∆∞·ªùi m·ªõi b·∫Øt ƒë·∫ßu.
      </p>
    </div>

    <div class="hero-image-wrap">
      <img class="hero-image"
           src="images/kho-quet.jpg"
           alt="Kho qu·∫πt truy·ªÅn th·ªëng"/>
      <div class="hero-tag" style="position:absolute;bottom:10px;right:16px;background:rgba(255,255,255,0.9);border-radius:999px;padding:6px 12px;font-size:11px;border:1px solid #f0e2d7;color:var(--muted);">
        M√≥n m·∫∑n ¬∑ Rau lu·ªôc ch·∫•m
      </div>
    </div>
  </section>

  <!-- MAIN -->
  <section class="main-layout">

    <!-- LEFT SIDE -->
    <div>
      <div class="card">
        <h3 class="section-heading">Nguy√™n li·ªáu</h3>

        <div class="servings-row" style="display:flex;align-items:center;gap:10px;font-size:13px;">
          <span>Kh·∫©u ph·∫ßn:</span>
          <div class="servings-controls" style="display:inline-flex;align-items:center;border:1px solid #f0dccf;border-radius:999px;background:#fff7f1;">
            <button id="minusServings">‚àí</button>
            <span class="servings-value" id="servingsValue">4</span>
            <button id="plusServings">+</button>
          </div>
          <span style="color:var(--muted);">ng∆∞·ªùi</span>
        </div>

        <ul class="pretty" id="ingredientList" style="font-size:14px;">
          <li class="ingredient-item" draggable="true"
              data-base-servings="4" data-base-qty="200" data-unit="g th·ªãt ba ch·ªâ nhi·ªÅu m·ª°.">
            <span class="ing-text">200 g th·ªãt ba ch·ªâ nhi·ªÅu m·ª°.</span>
          </li>

          <li class="ingredient-item" draggable="true"
              data-base-servings="4" data-base-qty="40" data-unit="g t√¥m kh√¥ (ng√¢m n∆∞·ªõc n√≥ng cho m·ªÅm).">
            <span class="ing-text">40 g t√¥m kh√¥ (ng√¢m n∆∞·ªõc n√≥ng cho m·ªÅm).</span>
          </li>

          <li class="ingredient-item" draggable="true"
              data-base-servings="4" data-base-qty="12" data-unit="g h√†nh t√≠m th√°i l√°t.">
            <span class="ing-text">10‚Äì15 g h√†nh t√≠m th√°i l√°t.</span>
          </li>

          <li class="ingredient-item" draggable="true"
              data-base-servings="4" data-base-qty="12" data-unit="g t·ªèi bƒÉm.">
            <span class="ing-text">10‚Äì15 g t·ªèi bƒÉm.</span>
          </li>

          <li class="ingredient-item" draggable="true"
              data-base-servings="4" data-base-qty="1" data-unit="tbsp ƒë∆∞·ªùng tr·∫Øng.">
            <span class="ing-text">1 th√¨a canh ƒë∆∞·ªùng tr·∫Øng.</span>
          </li>

          <li class="ingredient-item" draggable="true"
              data-base-servings="4" data-base-qty="1" data-unit="tbsp ƒë∆∞·ªùng n√¢u.">
            <span class="ing-text">1 th√¨a canh ƒë∆∞·ªùng n√¢u.</span>
          </li>

          <li class="ingredient-item" draggable="true"
              data-base-servings="4" data-base-qty="4" data-unit="tbsp n∆∞·ªõc m·∫Øm ngon.">
            <span class="ing-text">3‚Äì4 th√¨a canh n∆∞·ªõc m·∫Øm ngon.</span>
          </li>

          <li class="ingredient-item" draggable="true">
            <span class="ing-text">H√†nh l√° th√°i khoanh (kh√¥ng b·∫Øt bu·ªôc).</span>
          </li>

          <li class="ingredient-item" draggable="true">
            <span class="ing-text">2‚Äì3 qu·∫£ ·ªõt t∆∞∆°i, b·ªôt ·ªõt, ti√™u.</span>
          </li>

          <li class="ingredient-item" draggable="true">
            <span class="ing-text">D·∫ßu ƒÉn.</span>
          </li>
        </ul>
      </div>

      <div class="card">
        <h3 class="section-heading">C√°c b∆∞·ªõc th·ª±c hi·ªán</h3>
        <ol class="steps" style="font-size:14px;padding-left:18px;">
          <li>R·ª≠a s·∫°ch t√¥m kh√¥, ng√¢m v√†o n∆∞·ªõc s√¥i t·ªëi thi·ªÉu 20 ph√∫t cho t√¥m m·ªÅm.</li>
          <li>L·ªçc b·ªè da, th√°i th·ªãt ba ch·ªâ th√†nh h·∫°t l·ª±u. T√°ch ri√™ng ph·∫ßn m·ª° v√† n·∫°c (n·∫øu ƒë∆∞·ª£c).</li>
          <li>Rang ph·∫ßn m·ª° ·ªü l·ª≠a v·ª´a cho t√≥p m·ª° v√†ng v√† ti·∫øt m·ª° ra. V·ªõt t√≥p m·ª° ƒë·ªÉ ri√™ng.</li>
          <li>Phi th∆°m h√†nh t·ªèi, cho t√¥m v√† th·ªãt v√†o ƒë·∫£o sƒÉn.</li>
          <li>Pha h·ªón h·ª£p m·∫Øm theo t·ªâ l·ªá: 1 ƒë∆∞·ªùng ‚Äì 1.5/2 m·∫Øm ‚Äì 1.5 n∆∞·ªõc. C√≥ th·ªÉ d√πng n∆∞·ªõc ng√¢m t√¥m cho ƒë·∫≠m.</li>
          <li>ƒê·ªï h·ªón h·ª£p m·∫Øm v√†o ch·∫£o, th√™m t√≥p m·ª° v√† ·ªõt. Rim liu riu 5‚Äì10 ph√∫t ƒë·∫øn khi s·ªát.</li>
          <li>N√™m l·∫°i theo kh·∫©u v·ªã, th√™m ti√™u v√† h√†nh l√° tr∆∞·ªõc khi t·∫Øt b·∫øp.</li>
        </ol>
      </div>
    </div>

    <!-- RIGHT SIDE -->
    <div>

      <!-- VIDEO -->
      <div class="card video-wrapper">
        <span class="pill-label">Video h∆∞·ªõng d·∫´n</span>
        <h3 class="section-heading">Tham kh·∫£o c√°ch l√†m</h3>
        <iframe src="https://www.youtube.com/embed/uk_1KDqF69I" allowfullscreen
                style="width:100%;height:220px;border-radius:18px;border:none;"></iframe>
      </div>

      <!-- SHOPPING LIST -->
      <div class="card shopping-card">
        <span class="pill-label">Gi·ªè ƒëi ch·ª£</span>
        <h3 class="section-heading">K√©o nguy√™n li·ªáu sang ƒë√¢y</h3>
        <div id="shoppingDrop" class="shopping-drop">
          <span style="font-size:12px;color:var(--muted);">
            K√©o t·ª´ng nguy√™n li·ªáu b√™n tr√°i sang ƒë√¢y ƒë·ªÉ t·∫°o danh s√°ch mua.
          </span>
        </div>
      </div>

      <!-- SUBSTITUTIONS -->
      <div class="card sub-box">
        <span class="pill-label">Thay th·∫ø</span>
        <h3 class="section-heading">N·∫øu thi·∫øu nguy√™n li·ªáu?</h3>
        <ul style="padding-left:18px;font-size:13px;">
          <li><strong>Kh√¥ng c√≥ t√¥m kh√¥</strong> ‚Üí d√πng t√©p kh√¥ ho·∫∑c b·ªè qua, m√≥n s·∫Ω nh·∫π v·ªã h∆°n.</li>
          <li><strong>Kh√¥ng d√πng t√≥p m·ª°</strong> ‚Üí thay m·ª° b·∫±ng d·∫ßu ƒÉn, m√≥n v·∫´n s·ªát nh∆∞ng k√©m b√©o.</li>
          <li><strong>Kh√¥ng mu·ªën ng·ªçt</strong> ‚Üí gi·∫£m ¬Ω l∆∞·ª£ng ƒë∆∞·ªùng n√¢u.</li>
        </ul>
      </div>

      <!-- TIP -->
      <div class="tip-note" style="background:#fff8d9;border-radius:16px;padding:14px;margin-top:16px;">
        <p style="font-size:13px;"><strong>Tip nh·ªè xinh:</strong><br>
          Rim kho qu·∫πt ·ªü l·ª≠a nh·ªè s·∫Ω gi√∫p n∆∞·ªõc m·∫Øm s·ªát l·∫°i ƒë·∫πp, kh√¥ng b·ªã kh√©t ƒë∆∞·ªùng.
          Mu·ªën ƒÉn v·ªõi c∆°m ch√°y th√¨ n·∫•u s·ªát h∆°n m·ªôt ch√∫t ƒë·ªÉ b√°m t·ªët h∆°n.</p>
      </div>

      <!-- NOTES -->
      <div class="card">
        <span class="pill-label">Ghi ch√∫ c·ªßa b·∫°n</span>
        <h3 class="section-heading">L·∫ßn sau mu·ªën ch·ªânh g√¨?</h3>
        <textarea id="personalNotes" class="notes-area"
                  placeholder="V√≠ d·ª•: gi·∫£m ƒë∆∞·ªùng n√¢u, th√™m ti√™u xanh, n·∫•u s·ªát h∆°n,..."></textarea>
      </div>

    </div>
  </section>

  <!-- RECOMMEND -->
  <section class="recommend">
    <div class="card">
      <span class="pill-label">B·∫°n c√≥ th·ªÉ th√≠ch</span>
      <h3 class="section-heading">C√°c m√≥n m·∫∑n h·ª£p vibe</h3>

      <div class="recommend-grid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px;">
        <a class="rec-card" href="mon-man.html">
          <div class="rec-tag">M√≥n m·∫∑n</div>
          <div class="rec-title">C∆°m g√† s·ªët b∆° t·ªèi</div>
          <div>Th∆°m, ƒë·∫≠m v√† r·∫•t ƒë∆∞a c∆°m.</div>
        </a>

        <a class="rec-card" href="mon-man.html">
          <div class="rec-tag">M√≥n m·∫∑n</div>
          <div class="rec-title">Th·ªãt kho tr·ª©ng</div>
          <div>M√≥n kho truy·ªÅn th·ªëng d·ªÖ ƒÉn v√† h·ª£p m·ªçi nh√†.</div>
        </a>
      </div>
    </div>
  </section>

  <footer style="text-align:center;margin-top:40px;font-size:13px;color:var(--muted);">
    ¬© 2025 Nh√† B·∫øp Nh·ªè ‚Äì Kho qu·∫πt.
  </footer>

</div>

<!-- ================= JS SECTION (unchanged except RECIPE_ID) ================= -->
<script>
  const RECIPE_ID = "kho_quet";

  /* FAVORITES */
  const favBtn = document.getElementById("favBtn");
  const favIcon = document.getElementById("favIcon");
  const favLabel = document.getElementById("favLabel");

  function loadFavorite() {
    const favs = JSON.parse(localStorage.getItem("favorites") || "[]");
    if (favs.includes(RECIPE_ID)) {
      favBtn.classList.add("active");
      favIcon.textContent = "‚ô•";
      favLabel.textContent = "ƒê√£ th√™m v√†o y√™u th√≠ch";
    }
  }

  function toggleFavorite() {
    let favs = JSON.parse(localStorage.getItem("favorites") || "[]");
    if (favs.includes(RECIPE_ID)) {
      favs = favs.filter(id => id !== RECIPE_ID);
      favBtn.classList.remove("active");
      favIcon.textContent = "‚ô°";
      favLabel.textContent = "Th√™m v√†o y√™u th√≠ch";
    } else {
      favs.push(RECIPE_ID);
      favBtn.classList.add("active");
      favIcon.textContent = "‚ô•";
      favLabel.textContent = "ƒê√£ th√™m v√†o y√™u th√≠ch";
    }
    localStorage.setItem("favorites", JSON.stringify(favs));
  }

  favBtn.addEventListener("click", toggleFavorite);
  loadFavorite();

  /* RATING */
  const starContainer = document.getElementById("starContainer");
  const ratingText = document.getElementById("ratingText");

  function loadRating() {
    const rating = Number(localStorage.getItem("rating_" + RECIPE_ID) || 0);
    if (rating > 0) ratingText.textContent = `(${rating}/5)`;
    [...starContainer.children].forEach(span => {
      span.classList.toggle("active", Number(span.dataset.star) <= rating);
    });
  }

  starContainer.addEventListener("click", (e) => {
    if (e.target.dataset.star) {
      const val = Number(e.target.dataset.star);
      localStorage.setItem("rating_" + RECIPE_ID, val);
      loadRating();
    }
  });

  loadRating();

  /* SERVINGS */
  let currentServings = 4;
  const servingsValue = document.getElementById("servingsValue");
  const ingList = document.getElementById("ingredientList");

  function updateIngredients() {
    const items = ingList.querySelectorAll(".ingredient-item");
    items.forEach(li => {
      const baseServ = Number(li.dataset.baseServings || 0);
      const baseQty = Number(li.dataset.baseQty || 0);
      const unit = li.dataset.unit || "";
      const span = li.querySelector(".ing-text");
      if (baseServ && baseQty) {
        const newQty = baseQty * currentServings / baseServ;
        const display = Number.isInteger(newQty) ? newQty : newQty.toFixed(1);
        span.textContent = display + " " + unit;
      }
    });
  }

  document.getElementById("minusServings").onclick = () => {
    if (currentServings > 1) { currentServings--; servingsValue.textContent = currentServings; updateIngredients(); }
  };
  document.getElementById("plusServings").onclick = () => {
    if (currentServings < 12) { currentServings++; servingsValue.textContent = currentServings; updateIngredients(); }
  };

  updateIngredients();

  /* SHOPPING LIST */
  const shoppingDrop = document.getElementById("shoppingDrop");
  let draggedItem = null;

  function renderShoppingList() {
    const data = JSON.parse(localStorage.getItem("shopping_" + RECIPE_ID) || "[]");
    shoppingDrop.innerHTML = "";
    if (!data.length) {
      shoppingDrop.innerHTML =
        '<span style="font-size:12px;color:var(--muted);">K√©o nguy√™n li·ªáu sang ƒë√¢y ƒë·ªÉ th√™m v√†o danh s√°ch mua.</span>';
      return;
    }
    data.forEach((text, idx) => {
      const div = document.createElement("div");
      div.className = "shopping-item";
      div.style = "display:flex;justify-content:space-between;margin-bottom:4px;font-size:13px;";
      div.innerHTML = `<span>${text}</span><button data-idx="${idx}">‚úï</button>`;
      shoppingDrop.appendChild(div);
    });
  }

  ingList.querySelectorAll(".ingredient-item").forEach(li => {
    li.addEventListener("dragstart", () => {
      draggedItem = li.querySelector(".ing-text").textContent.trim();
      li.classList.add("dragging");
    });
    li.addEventListener("dragend", () => {
      li.classList.remove("dragging");
      draggedItem = null;
    });
  });

  shoppingDrop.addEventListener("dragover", e => e.preventDefault());
  shoppingDrop.addEventListener("drop", () => {
    if (draggedItem) {
      let data = JSON.parse(localStorage.getItem("shopping_" + RECIPE_ID) || "[]");
      if (!data.includes(draggedItem)) {
        data.push(draggedItem);
        localStorage.setItem("shopping_" + RECIPE_ID, JSON.stringify(data));
        renderShoppingList();
      }
    }
  });

  shoppingDrop.addEventListener("click", (e) => {
    if (e.target.tagName === "BUTTON") {
      let data = JSON.parse(localStorage.getItem("shopping_" + RECIPE_ID) || "[]");
      data.splice(Number(e.target.dataset.idx), 1);
      localStorage.setItem("shopping_" + RECIPE_ID, JSON.stringify(data));
      renderShoppingList();
    }
  });

  renderShoppingList();

  /* PERSONAL NOTES */
  const notesArea = document.getElementById("personalNotes");
  function loadNotes() {
    const text = localStorage.getItem("notes_" + RECIPE_ID) || "";
    notesArea.value = text;
  }
  notesArea.addEventListener("input", () => {
    localStorage.setItem("notes_" + RECIPE_ID, notesArea.value);
  });
  loadNotes();

  /* RANDOM WHEEL */
  const recipes = [
    { name: "Kho qu·∫πt", url: "kho-quet.html" },
    { name: "C∆°m g√† s·ªët b∆° t·ªèi", url: "mon-man.html" },
    { name: "B√°nh pancake chu·ªëi", url: "banh-pancake-chuoi.html" },
    { name: "Tr√† ƒë√†o cam s·∫£", url: "do-uong.html" }
  ];

  document.getElementById("randomBtn").onclick = () => {
    const box = document.getElementById("randomResult");
    box.textContent = "ƒêang suy nghƒ© gi√∫p b·∫°n h√¥m nay ƒÉn g√¨...";
    let count = 0;
    const interval = setInterval(() => {
      const r = recipes[Math.floor(Math.random()*recipes.length)];
      box.textContent = "Hay th·ª≠: " + r.name + "?";
      if (count++ > 10) {
        clearInterval(interval);
        const final = recipes[Math.floor(Math.random()*recipes.length)];
        box.innerHTML = `H√¥m nay th·ª≠ <strong>${final.name}</strong> nh√©?
        <a href="${final.url}" style="font-size:12px;">(Xem c√¥ng th·ª©c)</a>`;
      }
    }, 120);
  };

  /* MOOD POPUP */
  const moodOverlay = document.getElementById("moodOverlay");
  const moodNote = document.getElementById("moodNote");

  const moodTexts = {
    met: "B·∫°n c√≥ th·ªÉ chu·∫©n b·ªã √≠t nguy√™n li·ªáu h∆°n, ƒÉn v·ªõi rau lu·ªôc ƒë·ªÉ nh·∫π b·ª•ng h∆°n.",
    healthy: "Gi·∫£m l∆∞·ª£ng t√≥p m·ª°, tƒÉng rau lu·ªôc ‚Äì v·∫´n ngon m√† kh√¥ng qu√° n·∫∑ng.",
    voi: "N·∫•u b·∫£n s·ªát nhanh, √≠t nguy√™n li·ªáu ‚Äì ƒÉn v·ªõi c∆°m n√≥ng si√™u ti·ªán.",
    anui: "Cho th√™m t√≥p m·ª° v√† ti√™u ƒë·ªÉ m√≥n ƒë·∫≠m ƒë√†, ·∫•m b·ª•ng h∆°n."
  };

  document.getElementById("moodBtn").onclick = () => {
    moodOverlay.classList.add("show");
    moodNote.textContent = "";
  };

  moodOverlay.onclick = (e) => { if (e.target === moodOverlay) moodOverlay.classList.remove("show"); };

  document.querySelectorAll(".mood-btn").forEach(btn => {
    btn.onclick = () => {
      const mood = btn.dataset.mood;
      moodNote.textContent = moodTexts[mood] || "";
      setTimeout(()=>moodOverlay.classList.remove("show"), 1200);
    };
  });

  if (!localStorage.getItem("seen_mood_popup_khoquet")) {
    setTimeout(() => {
      moodOverlay.classList.add("show");
      localStorage.setItem("seen_mood_popup_khoquet","1");
    }, 800);
  }
</script>

</body>
</html>

